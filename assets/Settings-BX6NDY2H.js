import{c as M,r as n,j as e,k as le,l as ne,h as oe,A as J,d as X}from"./index-DjP7dUMH.js";import{s as b}from"./supabaseClient-B6bhcLjp.js";import{D as U}from"./database-CL2IrICc.js";import{S as ie}from"./sparkles-B0azafBo.js";import{S as ce}from"./save-Co8uzR3l.js";import{C as q}from"./circle-check-hWmEiH4g.js";import{C as de}from"./circle-x-DvDu8moa.js";import{T as Q}from"./trash-2-BcME0Dqw.js";import{F as me}from"./file-text-R5oTv0Xe.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],xe=M("file-braces",ge);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ue=M("play",pe);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],W=M("shield-alert",he);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Y=M("upload",be),Pe=()=>{const[S,T]=n.useState("idle"),[F,f]=n.useState(""),[N,C]=n.useState(null),[D,k]=n.useState(!1),[Z,l]=n.useState(""),[y,L]=n.useState({current:0,total:0}),[P,_]=n.useState(null),[O,R]=n.useState(""),[w,B]=n.useState(""),[V,z]=n.useState(""),[$,v]=n.useState({text:"",type:""}),[I,G]=n.useState("ai");n.useEffect(()=>{G(localStorage.getItem("dailyVerseSource")||"ai")},[]);const H=t=>{G(t),localStorage.setItem("dailyVerseSource",t)},K=async()=>{var t;T("loading"),f("");try{const{count:a,error:o}=await b.from("church_programs").select("*",{count:"exact",head:!0});if(o)throw o;const{error:i}=await b.from("songs").select("id").limit(1);if(i)throw new Error("Connected, but 'songs' table is missing or inaccessible. "+i.message);T("success"),f("Connection successful! Database is online and accessible.")}catch(a){if(console.error("Connection Test Error:",a),T("error"),(t=a.message)!=null&&t.includes("fetch"))f("Network Error: Could not reach Supabase. Check internet connection or URL.");else if(a.code==="PGRST301")f("Permission Error: RLS policies might be blocking access, but DB is reached.");else if(a.code==="42P01"){const o=a.message.includes("songs")?"songs":"church_programs";f(`Table Error: '${o}' table not found. Run the SQL script in README.`)}else f(`Error: ${a.message||"Unknown connection error"}`)}},ee=t=>{if(t.target.files&&t.target.files[0]){const a=t.target.files[0];if(a.type!=="application/json"&&!a.name.endsWith(".json")){alert("Please select a valid .json file");return}C(a),_(null),l("File ready to process."),t.target.value=""}},te=async()=>{if(!N){alert("No file selected.");return}k(!0),L({current:0,total:0}),l("Initializing import process...");try{l("Reading file from disk...");const t=await N.text();l("Parsing JSON data...");let a;try{a=JSON.parse(t)}catch{throw new Error("Invalid JSON syntax. Please check the file format.")}const o=(r,g=null,E=0)=>E>5?[]:!r||typeof r!="object"?[]:Array.isArray(r)?r.length>0&&("title"in r[0]||"lyrics"in r[0]||"number"in r[0])?r.map(u=>{let s=u.collection;if(!s&&g){const h=g.toUpperCase();h.includes("MHB")?s="MHB":h.includes("CAN")&&!h.includes("CANTICLE")?s="CAN":h.includes("CANTICLE")?s="CANTICLES_EN":s=g}return{...u,collection:s||"General"}}):r.flatMap(u=>o(u,g,E+1)):Object.keys(r).flatMap(p=>o(r[p],p,E+1));l("Scanning and categorizing songs...");const i=o(a),c=i.length;if(c===0)throw new Error("Could not find any songs in the file.");l("Checking database connection...");const{error:j}=await b.from("songs").select("id").limit(1);if(j&&j.code==="42P01")throw new Error("The 'songs' table does not exist in Supabase. Please run the SQL setup script.");L({current:0,total:c}),l(`Found ${c} songs. Starting upload...`);const d=50;let m=0,x=0;const A=Math.ceil(c/d);for(let r=0;r<c;r+=d){const g=Math.floor(r/d)+1;l(`Uploading batch ${g} of ${A}...`);const p=i.slice(r,r+d).map((s,h)=>{const re=Math.floor(Date.now()/1e3)+r+h+Math.floor(Math.random()*1e3);return{id:typeof s.id=="number"?s.id:re,collection:s.collection||"General",code:s.code||`GEN${s.number||h}`,number:typeof s.number=="number"?s.number:0,title:s.title||"Untitled Song",raw_title:s.raw_title||null,lyrics:s.lyrics||"",author:s.author||null,copyright:s.copyright||null,tags:s.tags||null,reference_number:s.reference_number||null}}),{error:u}=await b.from("songs").upsert(p);u?(console.error("Batch import error:",u),x+=p.length):m+=p.length,L(s=>({...s,current:Math.min(r+d,c)})),await new Promise(s=>setTimeout(s,10))}_({success:m,failed:x}),l("Import complete!"),C(null)}catch(t){console.error("Import Process Error:",t),l("Error: "+t.message),alert("Import failed: "+t.message)}finally{k(!1)}},se=async()=>{if(!confirm("DANGER: This will delete ALL songs from the database. Are you sure?"))return;k(!0),l("Clearing database...");const{error:t}=await b.from("songs").delete().neq("id",0);t?(alert("Error clearing table: "+t.message),l("Error clearing table")):(l("Database cleared."),_(null)),k(!1)},ae=t=>{t.preventDefault(),v({text:"",type:""});const a=localStorage.getItem("ministryAppPIN")||J.DEFAULT_PIN;if(O!==a){v({text:"Incorrect old PIN",type:"error"});return}if(w.length<4||w.length>6){v({text:"New PIN must be 4-6 digits",type:"error"});return}if(w!==V){v({text:"New PINs do not match",type:"error"});return}localStorage.setItem("ministryAppPIN",w),v({text:"PIN updated successfully!",type:"success"}),R(""),B(""),z("")};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in pb-12",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:e.jsx(le,{className:"w-8 h-8 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800",children:"System Settings"}),e.jsx("p",{className:"text-lg text-gray-500",children:"Manage application configuration and security"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-3 border-b pb-4",children:[e.jsx(ne,{className:"w-6 h-6 text-indigo-600"}),"Daily Verse Preference"]}),e.jsxs("div",{className:"bg-slate-50 p-6 rounded-lg border border-slate-100",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-3",children:"Verse Source"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>H("plan"),className:`flex-1 p-4 rounded-xl border-2 transition-all text-left flex items-start gap-3 ${I==="plan"?"border-indigo-600 bg-indigo-50 text-indigo-900":"border-slate-200 bg-white text-slate-500 hover:border-slate-300"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${I==="plan"?"bg-indigo-200":"bg-slate-100"}`,children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold block text-sm",children:"Planned List (Supabase)"}),e.jsx("span",{className:"text-xs opacity-80",children:"Cycle through pre-entered verses from database."})]})]}),e.jsxs("button",{onClick:()=>H("ai"),className:`flex-1 p-4 rounded-xl border-2 transition-all text-left flex items-start gap-3 ${I==="ai"?"border-purple-600 bg-purple-50 text-purple-900":"border-slate-200 bg-white text-slate-500 hover:border-slate-300"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${I==="ai"?"bg-purple-200":"bg-slate-100"}`,children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold block text-sm",children:"Auto-generate (AI)"}),e.jsx("span",{className:"text-xs opacity-80",children:"Use AI to pick a fresh verse each day."})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-3 border-b pb-4",children:[e.jsx(oe,{className:"w-6 h-6 text-slate-800"}),"Security"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-lg border border-slate-100",children:[e.jsx("h3",{className:"font-bold text-slate-700 mb-2",children:"App Lock Protection"}),e.jsxs("p",{className:"text-sm text-slate-500 mb-4",children:["Change the PIN used to unlock the application at startup. Default PIN is ",e.jsx("strong",{children:J.DEFAULT_PIN}),"."]}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"Current PIN",className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-slate-400 outline-none",value:O,onChange:t=>R(t.target.value),maxLength:6})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"password",placeholder:"New PIN",className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-slate-400 outline-none",value:w,onChange:t=>B(t.target.value),maxLength:6}),e.jsx("input",{type:"password",placeholder:"Confirm",className:"w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-slate-400 outline-none",value:V,onChange:t=>z(t.target.value),maxLength:6})]}),e.jsxs("button",{type:"submit",className:"w-full py-2.5 bg-slate-800 text-white rounded-lg hover:bg-black font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"})," Update PIN"]}),$.text&&e.jsx("div",{className:`text-sm text-center font-medium py-2 rounded ${$.type==="success"?"text-green-700 bg-green-50":"text-red-700 bg-red-50"}`,children:$.text})]})]}),e.jsxs("div",{className:"bg-slate-50 p-6 rounded-lg border border-slate-100 flex flex-col justify-center items-center text-center",children:[e.jsx(W,{className:"w-12 h-12 text-slate-300 mb-3"}),e.jsx("h3",{className:"font-bold text-slate-700 mb-1",children:"Session Security"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"The app automatically locks when you close the browser."}),e.jsx("button",{onClick:()=>{sessionStorage.removeItem("ministryAppUnlocked"),window.location.reload()},className:"px-6 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-100 font-medium shadow-sm transition-colors",children:"Lock App Now"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-3 border-b pb-4",children:[e.jsx(U,{className:"w-6 h-6 text-primary"}),"Database Connection"]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Supabase URL"}),e.jsx("code",{className:"text-lg font-mono text-gray-700 break-all block",children:b.supabaseUrl||"URL not found in client"})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Auth Status"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-lg text-gray-600",children:"Anonymous / Public Mode"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 pt-4",children:[e.jsxs("button",{onClick:K,disabled:S==="loading",className:"px-6 py-3 bg-primary text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-3 font-medium transition-all active:scale-95 text-lg",children:[S==="loading"?e.jsx(X,{className:"w-5 h-5 animate-spin"}):e.jsx(U,{className:"w-5 h-5"}),"Test Connection"]}),S==="success"&&e.jsxs("div",{className:"flex items-center gap-3 text-green-700 bg-green-50 px-6 py-3 rounded-lg border border-green-200 text-lg font-medium animate-fade-in",children:[e.jsx(q,{className:"w-6 h-6"}),F]}),S==="error"&&e.jsxs("div",{className:"flex items-center gap-3 text-red-700 bg-red-50 px-6 py-3 rounded-lg border border-red-200 text-lg font-medium animate-fade-in",children:[e.jsx(de,{className:"w-6 h-6"}),F]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 border border-gray-100",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-3 border-b pb-4",children:[e.jsx(xe,{className:"w-6 h-6 text-orange-600"}),"Data Management"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-900 mb-2",children:"Upload Constitution / Standing Orders"}),e.jsx("p",{className:"text-amber-800 mb-4 text-sm",children:"Upload a PDF or DOCX. The document will be parsed and saved to your database. You can then read and search it in Standing Orders."}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 shadow-sm font-medium transition-colors",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{children:"Select PDF/DOCX..."}),e.jsx("input",{type:"file",accept:".pdf,.docx",className:"hidden",onChange:async t=>{var o;const a=(o=t.target.files)==null?void 0:o[0];if(a)try{let i=[];if(a.type==="application/pdf"&&window.pdfjsLib){const j=await a.arrayBuffer(),d=await window.pdfjsLib.getDocument({data:j}).promise;for(let m=1;m<=d.numPages;m++){const r=(await(await d.getPage(m)).getTextContent()).items.map(g=>g.str).join(" ");r.trim()&&i.push({id:`p-${m}`,text:r,page:m})}}else if(a.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"&&window.mammoth){const j=await a.arrayBuffer();i=(await window.mammoth.extractRawText({arrayBuffer:j})).value.split(`
`).filter(x=>x.trim().length>0).map((x,A)=>({id:`d-${A}`,text:x.trim()}))}else{alert("Please upload a PDF or DOCX file.");return}const{error:c}=await b.from("uploaded_documents").upsert({filename:a.name,content:i},{onConflict:"filename"});alert(c?"Failed to save document: "+c.message:"Document uploaded and saved. Open Standing Orders to read it.")}catch(i){console.error(i),alert("Error uploading document.")}}})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/standing-orders"},className:"px-4 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 font-medium transition-colors",children:"Open Standing Orders"})]})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-100 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-orange-900 mb-2",children:"Import Songs Database"}),e.jsxs("p",{className:"text-orange-800 mb-6 text-base",children:["Upload the ",e.jsx("code",{className:"bg-white px-1 py-0.5 rounded border border-orange-200",children:"methodist_songs_flat.json"})," file here to populate the Hymnal section."]}),P&&e.jsxs("div",{className:"mb-6 p-4 bg-white rounded-lg border border-green-200 flex items-center gap-4 animate-fade-in shadow-sm",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(q,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-green-800 text-lg",children:"Import Successful!"}),e.jsxs("p",{className:"text-green-700",children:[P.success," songs uploaded successfully.",P.failed>0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(",P.failed," failed)"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[!D&&!N&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 shadow-sm font-medium transition-colors",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{children:"Select JSON File..."}),e.jsx("input",{type:"file",accept:".json",onChange:ee,className:"hidden"})]}),e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-transparent hover:border-red-100",children:[e.jsx(Q,{className:"w-5 h-5"})," Clear All Songs"]})]}),!D&&N&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:N.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(N.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("button",{onClick:()=>C(null),className:"text-gray-400 hover:text-red-500",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:te,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors shadow-sm",children:[e.jsx(ue,{className:"w-5 h-5 fill-white"})," Start Import"]}),e.jsx("button",{onClick:()=>C(null),className:"px-6 py-3 bg-white text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancel"})]})]}),D&&e.jsxs("div",{className:"space-y-3 bg-white p-4 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-orange-800 font-medium",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5 animate-spin"}),Z]}),e.jsxs("span",{children:[Math.round(y.current/(y.total||1)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-orange-100 rounded-full h-2.5",children:e.jsx("div",{className:"bg-orange-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${y.current/(y.total||1)*100}%`}})}),e.jsxs("p",{className:"text-xs text-orange-600 text-right",children:["Processed ",y.current," of ",y.total," items"]})]})]})]})]})]})]})};export{Pe as default};
